

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mplotqueries &mdash; mtools  documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/mtools.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Contribute to mtools" href="contributing.html" />
    <link rel="prev" title="mlogvis" href="mlogvis.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> mtools
          

          
            
            <img src="_static/mtools.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.5.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mlaunch.html">mlaunch</a></li>
<li class="toctree-l1"><a class="reference internal" href="mlogfilter.html">mlogfilter</a></li>
<li class="toctree-l1"><a class="reference internal" href="mloginfo.html">mloginfo</a></li>
<li class="toctree-l1"><a class="reference internal" href="mlogvis.html">mlogvis</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">mplotqueries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#general-parameters">General Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#help">Help</a></li>
<li class="toctree-l3"><a class="reference internal" href="#version">Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logarithmic-scale">Logarithmic Scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-title">Custom Title</a></li>
<li class="toctree-l3"><a class="reference internal" href="#operation-start-time">Operation Start Time</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-to-file">Output to File</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#groupings">Groupings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#group-by">Group By</a></li>
<li class="toctree-l3"><a class="reference internal" href="#group-limits">Group Limits</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#plot-types">Plot Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#connection-churn-plot">Connection Churn Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#duration-line-plot">Duration Line Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#event-plot">Event Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#histogram-plot">Histogram Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#range-plot">Range Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#replica-set-state-plot">Replica Set State Plot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scatter-plot">Scatter Plot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#overlays">Overlays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-overlays">Creating Overlays</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list-existing-overlays">List Existing Overlays</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remove-overlays">Remove Overlays</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contribute to mtools</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changes to mtools</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mtools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>mplotqueries</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mplotqueries">
<span id="id1"></span><h1>mplotqueries<a class="headerlink" href="#mplotqueries" title="Permalink to this headline">#</a></h1>
<p><strong>mplotqueries</strong> is a tool to visualize operations in MongoDB log files. It has
several different plot types and can group information in various ways.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">#</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries <span class="o">[</span>-h<span class="o">]</span> <span class="o">[</span>--version<span class="o">]</span> logfile <span class="o">[</span>logfile ...<span class="o">]</span>
             <span class="o">[</span>--group GROUP<span class="o">]</span>
             <span class="o">[</span>--logscale<span class="o">]</span>
             <span class="o">[</span>--type <span class="o">{</span>nscanned/n,rsstate,connchurn,durline,histogram,range,scatter,event<span class="o">}</span> <span class="o">]</span>
             <span class="o">[</span>--overlay <span class="o">[</span> <span class="o">{</span>add,list,reset<span class="o">}</span> <span class="o">]]</span>
             <span class="o">[</span>additional plot <span class="nb">type</span> parameters<span class="o">]</span>
</pre></div>
</div>
<p><strong>mplotqueries</strong> can also be used with shell pipe syntax, for example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mlogfilter logfile <span class="o">[</span>parameters<span class="o">]</span> <span class="p">|</span> mplotqueries --type histogram
</pre></div>
</div>
</div>
<div class="section" id="general-parameters">
<h2>General Parameters<a class="headerlink" href="#general-parameters" title="Permalink to this headline">#</a></h2>
<div class="section" id="help">
<h3>Help<a class="headerlink" href="#help" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">-h,</span> <span class="pre">--help</span></code></dt>
<dd>shows the help text and exits.</dd>
</dl>
</div>
<div class="section" id="version">
<h3>Version<a class="headerlink" href="#version" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--version</span></code></dt>
<dd>shows the version number and exits.</dd>
</dl>
</div>
<div class="section" id="logarithmic-scale">
<h3>Logarithmic Scale<a class="headerlink" href="#logarithmic-scale" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--logscale</span></code></dt>
<dd>This option enables the logarithmic scale for plots where this makes sense.
This is very useful if the plot contains outliers that squash all other data
points to the bottom of the graph (see below comparison on the same data
between log scale disabled and enabled). It can also be enabled with the
<code class="docutils literal notranslate"><span class="pre">l</span></code> (lowercase <code class="docutils literal notranslate"><span class="pre">L</span></code>) shortcut once a plot is rendered. Switching scale on
an already rendered plot may take a few seconds before the new scale is
shown.</dd>
</dl>
<div class="figure">
<img alt="Example plot: log scale compared" src="_images/mplotqueries_logscale.png" />
</div>
</div>
<div class="section" id="custom-title">
<h3>Custom Title<a class="headerlink" href="#custom-title" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--title</span></code></dt>
<dd>This option lets you overwrite the default title (the file name(s)) with a
custom title. If the title contains spaces, the full title needs to be
quoted in strings. The title of a plot is shown above the graph. A file read
in from <code class="docutils literal notranslate"><span class="pre">stdin</span></code> does not use a title.</dd>
</dl>
</div>
<div class="section" id="operation-start-time">
<h3>Operation Start Time<a class="headerlink" href="#operation-start-time" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--optime-start</span></code></dt>
<dd>Events are written to the log file when they finish, and by default,
mplotqueries plots the operation on the x-axis at that point in time.
Sometimes, it can be useful to see when operations started instead. For
operations that have a duration (queries, updates, etc.) mplotqueries can
subtract the duration and plot the operation when it started instead. Turn
this feature on with the <code class="docutils literal notranslate"><span class="pre">--optime-start</span></code> flag.</dd>
</dl>
</div>
<div class="section" id="output-to-file">
<h3>Output to File<a class="headerlink" href="#output-to-file" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--output-file</span></code></dt>
<dd>With this option, the plot can be written to a file rather than opening the
interactive view window. The format is auto-recognized from the filename
extension, with many supported formats, e.g. <code class="docutils literal notranslate"><span class="pre">.png</span></code>, <code class="docutils literal notranslate"><span class="pre">.pdf</span></code>, …</dd>
</dl>
</div>
</div>
<div class="section" id="groupings">
<h2>Groupings<a class="headerlink" href="#groupings" title="Permalink to this headline">#</a></h2>
<div class="section" id="group-by">
<h3>Group By<a class="headerlink" href="#group-by" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--group</span> <span class="pre">GROUP</span></code></p>
<blockquote>
<div>The group parameter specifies what the data should be grouped on. Grouping
can have different meaning for the various plots below, but generally,
groups are represented by color. A scatter plot would choose one color for
each group. A histogram plot would also choose a color per group, but
additionally stack the histogram groups on top of each other. Some plots
don’t support grouping at all. See <a class="reference internal" href="#plot-types"><span class="std std-ref">Plot Types</span></a> for information about
their grouping behavior.</div></blockquote>
<p>The following values are possible for <code class="docutils literal notranslate"><span class="pre">GROUP</span></code> for most plots (some plots may
not support all groups):</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">namespace</span></code> (default for single file)</li>
<li><code class="docutils literal notranslate"><span class="pre">filename</span></code> (default for multiple files)</li>
<li><code class="docutils literal notranslate"><span class="pre">operation</span></code> (queries, inserts, updates, …)</li>
<li><code class="docutils literal notranslate"><span class="pre">thread</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">log2code</span></code>  (not supported by every plot type)</li>
<li><code class="docutils literal notranslate"><span class="pre">pattern</span></code> (query pattern, e.g. <code class="docutils literal notranslate"><span class="pre">{foo:</span> <span class="pre">1,</span> <span class="pre">bar:</span> <span class="pre">1}</span></code>, no sub-documents)</li>
<li>custom grouping with regular expressions (see <a class="reference external" href="http://docs.python.org/2/library/re.html#regular-expression-syntax">Python’s regex syntax</a>)</li>
</ul>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries mongod.log --group operation
</pre></div>
</div>
<p>This command creates a scatter plot on duration (by default) and colors the
operations (queries, inserts, updates, deletes, commands, getmores) in
individual colors.</p>
<div class="figure">
<img alt="Example plot: operation groups" src="_images/mplotqueries_group_operation.png" />
</div>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mlogfilter mongod.log --operation update --namespace test.users <span class="p">|</span>
mplotqueries --type histogram --group <span class="s2">&quot;_id: ObjectId\(&#39;([^&#39;]+)&#39;\)&quot;</span>
</pre></div>
</div>
<p>This command combination creates a histogram plot on duration of all the update
operations on the <code class="docutils literal notranslate"><span class="pre">test.users</span></code> collection and groups the updates based on the
<code class="docutils literal notranslate"><span class="pre">_id</span></code> ObjectId (extracted by the regular expression). If parentheses are
present in the regular expression, then only the first matched group is being
used as the group string (in this case, the 24 hex characters in the ObjectId).
If parentheses are not present, the full regex match is being used as group
string. Parentheses (and other reserved symbols) that need to be matched
literally (like the parentheses in <code class="docutils literal notranslate"><span class="pre">ObjectId('...')</span></code> above) need to be
escaped with a <code class="docutils literal notranslate"><span class="pre">\</span></code>.</p>
<p>If the number of groups is large, like in this example, it can be reduced with
<a class="reference internal" href="#group-limits"><span class="std std-ref">Group Limits</span></a>.</p>
<div class="figure">
<img alt="Example plot: regex groups" src="_images/mplotqueries_group_regex.png" />
</div>
</div>
<div class="section" id="group-limits">
<span id="id2"></span><h3>Group Limits<a class="headerlink" href="#group-limits" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--group-limit</span> <span class="pre">N</span></code></dt>
<dd><p class="first">This parameter will limit the number of groups to the top <code class="docutils literal notranslate"><span class="pre">N</span></code>, based on
the number of matching lines per group (descending). The remaining groups
are then grouped together in a single bucket called <code class="docutils literal notranslate"><span class="pre">other</span></code>. This option
is useful if the number of groups is very large, as repetitions in color
(there are only 14 distinct colors) could otherwise make it hard to
distinguish all the groups for some plot types.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries mongod.log --type range --group log2code --group-limit <span class="m">10</span>
</pre></div>
</div>
<p>This command creates a range plot, grouped on <code class="docutils literal notranslate"><span class="pre">log2code</span></code>, but only
displays the 10 most frequently occurring log messages as separate groups.
All others are plotted as one additional group <code class="docutils literal notranslate"><span class="pre">others</span></code>.</p>
<div class="last figure">
<img alt="Example plot: group limits" src="_images/mplotqueries_group_limit.png" />
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="plot-types">
<span id="id3"></span><h2>Plot Types<a class="headerlink" href="#plot-types" title="Permalink to this headline">#</a></h2>
<div class="section" id="connection-churn-plot">
<h3>Connection Churn Plot<a class="headerlink" href="#connection-churn-plot" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--type</span> <span class="pre">connchurn</span></code></dt>
<dd>A connection churn plot is a special plot that only considers lines about
opening and closing connections. It will then create an opened (green bars)
vs. closed (red bars) plot over time, and additionally show the number of
currently open connections (black line, only for MongoDB log files &gt;= 2.2).</dd>
</dl>
<div class="section" id="available-groupings">
<h4>Available Groupings<a class="headerlink" href="#available-groupings" title="Permalink to this headline">#</a></h4>
<p>No groupings are supported by this type of plot.</p>
</div>
<div class="section" id="additional-parameters">
<h4>Additional Parameters<a class="headerlink" href="#additional-parameters" title="Permalink to this headline">#</a></h4>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--bucketsize</span> <span class="pre">SIZE,</span> <span class="pre">-b</span> <span class="pre">SIZE</span> <span class="pre">(alias)</span></code></dt>
<dd><p class="first">As with histogram plots, this parameter sets the bucket size for an
individual bucket (bar). The unit is measured in seconds and the default
value is 60 seconds. This needs to be adjusted if the total time span of a
log file is rather large. More than 1000 buckets are slow to render, and
<strong>mplotqueries</strong> will output a warning to consider increasing the bucket
size.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries mongod.log --type connchurn --bucketsize <span class="m">600</span>
</pre></div>
</div>
<p class="last">This command plots connection churn per 10 minutes (600 seconds) as a
bi-directional histogram plot, as well as the total number of open
connections at each time (black line).</p>
</dd>
</dl>
<div class="figure">
<img alt="Example plot: connection churn" src="_images/mplotqueries_connchurn.png" />
</div>
</div>
</div>
<div class="section" id="duration-line-plot">
<h3>Duration Line Plot<a class="headerlink" href="#duration-line-plot" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--type</span> <span class="pre">durline</span></code></dt>
<dd><p class="first">The Duration Line plot shows operations that have a duration (like queries,
updates, inserts, commands, etc). It draws a diagonal line from when the
operation started (touching the x-axis) to when the operation stopped. This
plot is especially useful to see when operations started and what impact
they had on other queries during that time. It has the nice side-effect that
all operations that started at the same time lie on the same diagonal line.
Duration Line plots also make good plots to overlay with others.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grep <span class="s2">&quot;oplog.rs&quot;</span> mongod.log <span class="p">|</span> mplotqueries --type durline --overlay
mplotqueries mongod.log --group operation
</pre></div>
</div>
<p class="last">This command plots long-running oplog.rs operations as duration lines, and
overlays them with a scatter plot of all operations.</p>
</dd>
</dl>
<div class="figure">
<img alt="Example plot: duration line plot" src="_images/mplotqueries_durline.png" />
</div>
</div>
<div class="section" id="event-plot">
<h3>Event Plot<a class="headerlink" href="#event-plot" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--type</span> <span class="pre">event</span></code></dt>
<dd><p class="first">Event plots show the occurrence of certain events in a log file. They make
sense mostly in combination with a preceding filter, either <code class="docutils literal notranslate"><span class="pre">mlogfilter</span></code>
or a <code class="docutils literal notranslate"><span class="pre">grep</span></code>. For each matching event, a vertical line will be plotted at
the time the event occurred. If the number of events is very large, you may
want to consider using a range plot instead.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grep <span class="s2">&quot;getlasterror&quot;</span> mongod.log <span class="p">|</span> mplotqueries --type event
</pre></div>
</div>
<p class="last">This plot shows the occurrences of all “getlasterror” events in the log
file.</p>
</dd>
</dl>
<div class="figure">
<img alt="Example plot: rsstate" src="_images/mplotqueries_event.png" />
</div>
<div class="section" id="id4">
<h4>Available Groupings<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h4>
<p>Event plots use colors and to display different groups. The supported groupings
for event plots are: <code class="docutils literal notranslate"><span class="pre">namespace</span></code>, <code class="docutils literal notranslate"><span class="pre">operation</span></code>, <code class="docutils literal notranslate"><span class="pre">thread</span></code>, <code class="docutils literal notranslate"><span class="pre">filename</span></code>
(for multiple files), and regular expressions.</p>
</div>
<div class="section" id="id5">
<h4>Additional Parameters<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h4>
<p>No additional parameters are supported by this type of plot.</p>
</div>
</div>
<div class="section" id="histogram-plot">
<h3>Histogram Plot<a class="headerlink" href="#histogram-plot" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--type</span> <span class="pre">histogram</span></code></dt>
<dd>Histogram plots don’t consider a particular value in the log line (like for
example scatter plots do), but rather bin the occurrence of log lines
together in time buckets and present the result as a bar chart. The more
occurrences of a certain log line (per group) in a given time frame, the
higher the bar for that bucket. The size of a bucket is 60 seconds by
default, but can be configured to another value (<code class="docutils literal notranslate"><span class="pre">--bucketsize</span></code>, see
below). Unless one wants to know the total number of log lines per time
bucket (which is not very useful information), this command should always be
preceded with a filter, for example <a class="reference internal" href="mlogfilter.html#mlogfilter"><span class="std std-ref">mlogfilter</span></a> or
<a class="reference external" href="http://unixhelp.ed.ac.uk/CGI/man-cgi?grep">grep</a>.</dd>
</dl>
<div class="section" id="id6">
<h4>Available Groupings<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h4>
<p>Histogram plots use colors to display different groups. Each group gets its own
bar, the bars are stacked on top of each other to also give an indication of
the total number of matched lines per bucket. The supported groupings for
histogram plots are: <code class="docutils literal notranslate"><span class="pre">namespace</span></code>, <code class="docutils literal notranslate"><span class="pre">operation</span></code>, <code class="docutils literal notranslate"><span class="pre">thread</span></code>, <code class="docutils literal notranslate"><span class="pre">filename</span></code>
(for multiple files), <code class="docutils literal notranslate"><span class="pre">log2code</span></code> and regular expressions.</p>
</div>
<div class="section" id="id7">
<h4>Additional Parameters<a class="headerlink" href="#id7" title="Permalink to this headline">#</a></h4>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--bucketsize</span> <span class="pre">SIZE,</span> <span class="pre">-b</span> <span class="pre">SIZE</span> <span class="pre">(alias)</span></code></dt>
<dd><p class="first">This parameter sets the bucket size for an individual bucket (bar). The unit
is measured in seconds and the default value is 60 seconds. This needs to be
adjusted if the total time span of a log file is rather large. More than
1000 buckets are slow to render, and <strong>mplotqueries</strong> will output a warning
to consider increasing the bucket size.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mlogfilter mongod.log --operation insert <span class="p">|</span>
mplotqueries --type histogram --bucketsize <span class="m">3600</span>
</pre></div>
</div>
<p class="last">This command plots the inserts per hour (3600 seconds) as a histogram plot.
By default, the grouping is on <code class="docutils literal notranslate"><span class="pre">namespace</span></code>.</p>
</dd>
</dl>
<div class="figure">
<img alt="Example plot: histogram inserts per hour" src="_images/mplotqueries_histogram_inserts.png" />
</div>
</div>
</div>
<div class="section" id="range-plot">
<h3>Range Plot<a class="headerlink" href="#range-plot" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--type</span> <span class="pre">range</span></code></dt>
<dd>Range plots are good in displaying when certain events occurred and how long
they lasted. For example, you can grep for a certain error message and use
the range plot to see when these errors mostly occurred. For each group, a
range plot shows one or several (if the <code class="docutils literal notranslate"><span class="pre">--gap</span></code> option is used) horizontal
bars, that go from beginning to end of a certain event. If no <code class="docutils literal notranslate"><span class="pre">--gap</span></code>
value is provided, the default is to not have any gaps at all, and the bar
goes from the time of the first to the time of the last line of that group.
If <code class="docutils literal notranslate"><span class="pre">--gap</span></code> is used, then the bar is interrupted whenever two consecutive
log lines are further apart than the gap threshold.</dd>
</dl>
<div class="section" id="id8">
<h4>Available Groupings<a class="headerlink" href="#id8" title="Permalink to this headline">#</a></h4>
<p>Range plots use colors to display different groups. Each group gets its own
horizontal bar(s). The supported groupings for range plots are: <code class="docutils literal notranslate"><span class="pre">namespace</span></code>,
<code class="docutils literal notranslate"><span class="pre">operation</span></code>, <code class="docutils literal notranslate"><span class="pre">thread</span></code>, <code class="docutils literal notranslate"><span class="pre">filename</span></code> (for multiple files), <code class="docutils literal notranslate"><span class="pre">log2code</span></code> and
regular expressions.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries primary.log seconary1.log secondary2.log --type range
</pre></div>
</div>
<p>This plot shows for multiple files when they start and finish. By default, the
grouping for multiple files is on <code class="docutils literal notranslate"><span class="pre">filename</span></code>, and as there is no gap
threshold given, the bars range from the first two the last log line per file.
This is useful to find out if and where several log files have an overlap.</p>
<div class="figure">
<img alt="Example plot: range plot on operations" src="_images/mplotqueries_range_multiple.png" />
</div>
</div>
<div class="section" id="id9">
<h4>Additional Parameters<a class="headerlink" href="#id9" title="Permalink to this headline">#</a></h4>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--gap</span> <span class="pre">LEN</span></code></dt>
<dd><p class="first">If a gap threshold is provided, then the horizontal bars are interrupted
when two consecutive events of the same group are further apart than <code class="docutils literal notranslate"><span class="pre">LEN</span></code>
seconds.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries mongod.log --type range --group operation --gap <span class="m">600</span>
</pre></div>
</div>
<p class="last">This plot shows ranges of contiguous blocks of updates where the gap
threshold is 600 seconds (only gaps between two operations that are larger
than 10 minutes are displayed as separate bars).</p>
</dd>
</dl>
<div class="figure">
<img alt="Example plot: range plot on operations" src="_images/mplotqueries_range.png" />
</div>
</div>
</div>
<div class="section" id="replica-set-state-plot">
<h3>Replica Set State Plot<a class="headerlink" href="#replica-set-state-plot" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--type</span> <span class="pre">rsstate</span></code></dt>
<dd><p class="first">Replica set state plots are specialized event plots, that only consider
lines about replica set state changes in a log file. They will display all
changes of all replica set members (not just the node itself) with colored
vertical lines, indicating different states. The most common states are
<code class="docutils literal notranslate"><span class="pre">PRIMARY</span></code>, <code class="docutils literal notranslate"><span class="pre">SECONDARY</span></code>, <code class="docutils literal notranslate"><span class="pre">ARBITER</span></code>, <code class="docutils literal notranslate"><span class="pre">STARTUP2</span></code>, <code class="docutils literal notranslate"><span class="pre">DOWN</span></code> and
<code class="docutils literal notranslate"><span class="pre">RECOVERING</span></code>, but other state changes are also displayed if found. This
plot type helps to quickly determine any state changes at a given time. It
is also useful to <a class="reference internal" href="#overlay"><span class="std std-ref">Overlays</span></a> this plot with a different plot, for
example a scatter plot.</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries mongod.log --type rsstate
</pre></div>
</div>
<p class="last">This plot shows the state changes of all replica set members found in the
log file.</p>
</dd>
</dl>
<div class="figure">
<img alt="Example plot: rsstate" src="_images/mplotqueries_rsstate.png" />
</div>
<div class="section" id="id10">
<h4>Available Groupings<a class="headerlink" href="#id10" title="Permalink to this headline">#</a></h4>
<p>No groupings are supported by this type of plot.</p>
</div>
<div class="section" id="id11">
<h4>Additional Parameters<a class="headerlink" href="#id11" title="Permalink to this headline">#</a></h4>
<p>No additional parameters are supported by this type of plot.</p>
</div>
</div>
<div class="section" id="scatter-plot">
<h3>Scatter Plot<a class="headerlink" href="#scatter-plot" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--type</span> <span class="pre">scatter</span></code> (default)</dt>
<dd>A scatter plot prints a marker on a two-dimensional axis, where the x-axis
represents date and time, and the y-axis represents a certain numeric value.
The numeric value for the y-axis can be chosen with an additional parameter
(<code class="docutils literal notranslate"><span class="pre">--yaxis</span></code>, see below). By default, scatter plots show the duration of
operations (queries, updates, inserts, deletes, …) on the y-axis.</dd>
</dl>
<div class="section" id="id12">
<h4>Available Groupings<a class="headerlink" href="#id12" title="Permalink to this headline">#</a></h4>
<p>Scatter plots use colors and additionally different marker shapes (circles,
squares, diamonds, …) to display different groups. The supported groupings
for scatter plots are: <code class="docutils literal notranslate"><span class="pre">namespace</span></code>, <code class="docutils literal notranslate"><span class="pre">operation</span></code>, <code class="docutils literal notranslate"><span class="pre">thread</span></code>, <code class="docutils literal notranslate"><span class="pre">filename</span></code>
(for multiple files), and regular expressions.</p>
</div>
<div class="section" id="id13">
<h4>Additional Parameters<a class="headerlink" href="#id13" title="Permalink to this headline">#</a></h4>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--yaxis</span> <span class="pre">FIELD</span></code></dt>
<dd><p class="first">This parameter determines what value should be considered for the location
on the y-axis. By default, the y-axis plots <code class="docutils literal notranslate"><span class="pre">duration</span></code>. Other
possibilities are <code class="docutils literal notranslate"><span class="pre">nscanned</span></code>, <code class="docutils literal notranslate"><span class="pre">nupdated</span></code>, <code class="docutils literal notranslate"><span class="pre">ninserted</span></code>, <code class="docutils literal notranslate"><span class="pre">ntoreturn</span></code>,
<code class="docutils literal notranslate"><span class="pre">nreturned</span></code>, <code class="docutils literal notranslate"><span class="pre">numYields</span></code>, <code class="docutils literal notranslate"><span class="pre">r</span></code> (read lock), <code class="docutils literal notranslate"><span class="pre">w</span></code> (write lock).</p>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries mongod.log --type scatter --yaxis w
</pre></div>
</div>
<p class="last">This command plots the time (x-axis) vs. the write lock values of all
operations (y-axis). Only lines that have a write lock value present are
considered for the plot. Note that the unit for read/write lock is in
microseconds.</p>
</dd>
</dl>
<div class="figure">
<img alt="Example plot: scatter write lock" src="_images/mplotqueries_scatter_w.png" />
</div>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--type</span> <span class="pre">nscanned</span></code></dt>
<dd><p class="first">The scan ratio plot is a special type of scatter plot. Instead of plotting a
single field as the standard scatter plot, it will calculate the ratio
between the nscanned value and the nreturned value, and uses that result as
the value for the y-axis. This plot is very useful to quickly find
inefficient queries.</p>
<p>For example:</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries mongod.log --type nscanned/n
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="overlays">
<span id="overlay"></span><h2>Overlays<a class="headerlink" href="#overlays" title="Permalink to this headline">#</a></h2>
<p>The overlay mechanism allows you to overlay several plot types in one graphic.
This is useful to see correlations, match information from different plot types
and create graphs that show events from different angles.</p>
<p>Each of the plot types can in theory be used as an overlay, however some of
them make more sense then others.</p>
<p>Overlays are created just as normal plots, except they are stored on disk and
do not render immediately. The first call to <strong>mplotqueries</strong> that does not add
another overlay then will load all existing overlays added previously and
render them on top of each other, matching the time axis.</p>
<p>Overlays are stored globally and are persistent, independent of your current
working directory. Therefore, if you no longer need to store added overlays,
make sure that you remove them again or they will be added to your next call of
<strong>mplotqueries</strong>.</p>
<p>Plot types that are often used for overlays are: event, range, rsstate, and
scatter.</p>
<div class="section" id="creating-overlays">
<h3>Creating Overlays<a class="headerlink" href="#creating-overlays" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--overlay</span> <span class="pre">[add]</span></code></dt>
<dd>To create an overlay, run <strong>mplotqueries</strong> as you would normally, with all
the command line arguments. In addition, specify the <code class="docutils literal notranslate"><span class="pre">--overlay</span> <span class="pre">add</span></code>
argument. As <code class="docutils literal notranslate"><span class="pre">add</span></code> is the default for overlays, it can be omitted.</dd>
</dl>
<p>For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mplotqueries mongod.log --type scatter --overlay

Created overlay: <span class="m">18124963</span>
</pre></div>
</div>
<p>This will add an overlay plot. The plot is not shown but saved on disk
instead, and rendered with the next call without <code class="docutils literal notranslate"><span class="pre">--overlay</span></code>.</p>
</div>
<div class="section" id="list-existing-overlays">
<h3>List Existing Overlays<a class="headerlink" href="#list-existing-overlays" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--overlay</span> <span class="pre">list</span></code></dt>
<dd>To see if overlays are currently existing, you can use this command. A list
of existing overlay identifiers will be returned. Currently, the
indentifiers are not all that useful by themselves, but the command will
show you how many different overlays exist.</dd>
</dl>
</div>
<div class="section" id="remove-overlays">
<h3>Remove Overlays<a class="headerlink" href="#remove-overlays" title="Permalink to this headline">#</a></h3>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">--overlay</span> <span class="pre">reset</span></code></dt>
<dd>To remove all overlays, you can use this command. It will delete all
existing overlays, and the next (or current, if a log file is specified as
well) call to <strong>mplotqueries</strong> will not show additional overlays anymore.</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="contributing.html" class="btn btn-neutral float-right" title="Contribute to mtools" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mlogvis.html" class="btn btn-neutral" title="mlogvis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>